{"version":3,"sources":["engine/types.ts","controller/adapters/rest.tsx","controller/types.ts","pages/game/ControllerCreator.tsx","engine/utils.ts","pages/game/Run.tsx","engine/game.ts","store/index.ts","pages/game/Setup.tsx","pages/game/GameRunner.tsx","store/download.ts","pages/game/Summary.tsx","pages/Home.tsx","pages/parts/Content.tsx","pages/parts/Footer.tsx","pages/parts/Header.tsx","pages/Tester.tsx","viewer/Canvas.tsx","viewer/Snapshot.tsx","viewer/Viewer.tsx","pages/Viewer.tsx","App.tsx","index.tsx"],"names":["Move","headers","RestController","url","init","payload","a","axios","post","response","data","update","state","this","RestControllerSelector","setController","position","inputCallback","useCallback","event","controller","target","value","Item","label","name","prefix","GlobalOutlined","onChange","isController","ControllerCreator","onControllerChange","onNext","controllers","useMemo","selectCallback","pos","filter","type","onClick","RunStage","randomPos","bounds","Math","floor","random","gameHistorySummarise","history","meta","winner","length","playerAlive","findIndex","p","ticks","map","h","omit","timeStamp","Date","toISOString","tickCount","defaultOptions","gridSize","maxTicks","Game","options","gameState","controllersReady","initState","Array","fill","Promise","all","c","i","playerNumber","gameId","playerCount","every","r","Error","JSON","stringify","allStates","tick","copy","cloneDeep","push","newState","positions","lastMoves","food","uuidv4","uniquePos","poss","controllerMoves","apply","oldState","forEach","move","player","currentHead","moveVec","NORTH","SOUTH","EAST","WEST","moveToVector2d","newHead","some","x","y","pop","unshift","Paragraph","Typography","StoreKeys","Run","props","onCancel","onPrev","stateUpdate","g","runStage","game","CONTROLLER_INIT","initControllers","then","setState","GAME_RUN","catch","err","ERROR_STATE","errorTitle","errorDesc","message","run","gameComplete","GAME_OVER","statusMessage","description","showIcon","UNSET","_","prevState","body","danger","React","Component","GameSetup","onConfigChange","useState","setGridSize","setMaxTicks","changeCallback","onMaxTicksChange","onGridSizeChange","useEffect","min","max","defaultValue","SetupStage","getHistories","store","get","HISTORIES","setHistories","histories","set","createDownloadHref","gameHistory","jsonBlob","Blob","href","URL","createObjectURL","download","Panel","Collapse","Summary","handleSave","addHistory","downloadProps","icon","TrophyOutlined","status","title","DownloadOutlined","SaveOutlined","defaultActiveKey","header","Step","Steps","Title","GameRunner","CONTROLLER_CREATOR","currentStage","setCurrentStage","setControllers","setOptions","setGameHistory","creatorCallback","completeCallback","nextCallback","SUMMARY","prevCallback","current","GAME_SETUP","PLAYING","HomePage","Content","Layout","ContentPart","className","children","Footer","FooterPart","Header","HeaderPart","theme","mode","to","TabPane","Tabs","sampleIniData","sampleStateData","ControllerTesterPage","setResponse","sendData","setSendData","loaderCallback","newController","gameIniButton","e","stateSendButton","tab","gutter","span","CANVAS_SIZE","drawPart","ctx","partSize","colour","fillStyle","fillRect","Canvas","canvasRef","useRef","useLayoutEffect","canvas","getContext","clearRect","strokeRect","clearCanvas","snake","drawSnake","width","height","ref","StateSnapshot","frame","playerData","key","alive","lastMove","columns","dataIndex","render","CheckCircleOutlined","CloseCircleOutlined","ellipsis","size","dataSource","pagination","expandable","expandedRowRender","record","style","margin","Viewer","setTick","sliderChange","justify","marginLeft","marginRight","ViewerPage","loadedHistory","setLoadedHistory","savedGames","setSavedGames","humanDate","toString","rest","EyeOutlined","id","removeHistory","DeleteOutlined","App","exact","path","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e6c87749.chunk.js","sourcesContent":["export type GameOptions = {\r\n  gridSize: number;\r\n  maxTicks: number;\r\n};\r\n\r\nexport type MetalessGameState = Omit<GameState, \"meta\">;\r\nexport type GameHistory = {\r\n  tickCount: number;\r\n  ticks: MetalessGameState[];\r\n  winner: number;\r\n  gridSize: number;\r\n  playerCount: number;\r\n  gameId: string;\r\n  timeStamp: string;\r\n};\r\n\r\nexport type GameOptionsOptionals = {};\r\n\r\nexport enum Move {\r\n  NORTH = \"N\",\r\n  SOUTH = \"S\",\r\n  EAST = \"E\",\r\n  WEST = \"W\",\r\n}\r\n\r\nexport type Pos = [number, number];\r\n\r\nexport type GameState = {\r\n  tick: number;\r\n  positions: Array<Pos[]>;\r\n  food: Pos[];\r\n  playerAlive: boolean[];\r\n  lastMoves: Move[];\r\n  meta: {\r\n    gridSize: number;\r\n    playerCount: number;\r\n    gameId: string;\r\n  };\r\n};\r\n","import { Form, Input } from \"antd\";\r\nimport axios from \"axios\";\r\nimport React, { useCallback } from \"react\";\r\nimport { GlobalOutlined } from \"@ant-design/icons\";\r\nimport { GameState } from \"../../engine/types\";\r\nimport { Controller, ControllerSelectorProps, InitPayload } from \"../types\";\r\n\r\nconst headers = { \"Access-Control-Allow-Origin\": \"*\" };\r\n\r\nexport class RestController implements Controller {\r\n  private url: string;\r\n\r\n  constructor(url: string) {\r\n    this.url = url;\r\n  }\r\n\r\n  init = async (payload: InitPayload) => {\r\n    const response = await axios.post(this.url, payload, { headers });\r\n    return response.data;\r\n  };\r\n\r\n  update = async (state: GameState) => {\r\n    const response = await axios.post(this.url, state, { headers });\r\n    return response.data;\r\n  };\r\n}\r\n\r\nexport const RestControllerSelector: React.FunctionComponent<ControllerSelectorProps> =\r\n  ({ setController, position }) => {\r\n    const inputCallback = useCallback(\r\n      (event) => {\r\n        const controller = new RestController(event.target.value);\r\n        setController(controller);\r\n      },\r\n      [setController]\r\n    );\r\n\r\n    return (\r\n      <Form.Item label=\"Address\" name={position}>\r\n        <Input prefix={<GlobalOutlined />} onChange={inputCallback} />\r\n      </Form.Item>\r\n    );\r\n  };\r\n","import { GameState, Move } from \"../engine/types\";\r\n\r\nexport type InitPayload = {\r\n  gameId: string;\r\n  gridSize: number;\r\n  playerCount: number;\r\n  playerNumber: number;\r\n};\r\n\r\nexport interface Controller {\r\n  init: (initPayload: InitPayload) => Promise<void>;\r\n  update: (state: GameState) => Promise<Move>;\r\n}\r\n\r\nexport type ControllerSelectorProps = {\r\n  setController: (controller: Controller) => void;\r\n  position?: number;\r\n};\r\n\r\nexport const isController = (\r\n  controller: Controller | undefined\r\n): controller is Controller => {\r\n  return !!controller;\r\n};\r\n","import { Button, Form } from \"antd\";\r\nimport React, { useCallback, useMemo } from \"react\";\r\nimport { RestControllerSelector } from \"../../controller/adapters/rest\";\r\nimport { Controller, isController } from \"../../controller/types\";\r\n\r\nexport type ControllerCreatorProps = {\r\n  onControllerChange: (controllers: Controller[]) => void;\r\n  onNext: () => void;\r\n};\r\n\r\nexport const ControllerCreator: React.FunctionComponent<ControllerCreatorProps> =\r\n  ({ onControllerChange, onNext }) => {\r\n    const controllers: Array<Controller | undefined> = useMemo(() => [], []);\r\n\r\n    const selectCallback = useCallback(\r\n      (pos) => (controller: Controller) => {\r\n        controllers[pos] = controller;\r\n        onControllerChange(controllers.filter(isController));\r\n      },\r\n      [onControllerChange, controllers]\r\n    );\r\n\r\n    return (\r\n      <>\r\n        <Form>\r\n          <RestControllerSelector setController={selectCallback(0)} />\r\n          <RestControllerSelector setController={selectCallback(1)} />\r\n        </Form>\r\n\r\n        <Button type=\"primary\" onClick={onNext}>\r\n          Next\r\n        </Button>\r\n      </>\r\n    );\r\n  };\r\n","import { omit } from \"lodash\";\r\nimport { GameHistory, GameState, Move, Pos } from \"./types\";\r\n\r\nexport const randomPos = (bounds: number): Pos => {\r\n  return [\r\n    Math.floor(Math.random() * bounds),\r\n    Math.floor(Math.random() * bounds),\r\n  ];\r\n};\r\n\r\nexport const moveToVector2d = (move: Move): [number, number] => {\r\n  const vecs: { [key: string]: [number, number] } = {\r\n    [Move.NORTH]: [0, -1],\r\n    [Move.SOUTH]: [0, 1],\r\n    [Move.EAST]: [1, 0],\r\n    [Move.WEST]: [-1, 0],\r\n  };\r\n  return vecs[move];\r\n};\r\n\r\nexport const withinBounds = (pos: Pos, bounds: number): boolean => {\r\n  return pos.every((p) => p >= 0 && p < bounds);\r\n};\r\n\r\nexport const gameHistorySummarise = (history: GameState[]): GameHistory => {\r\n  const meta = history[0].meta;\r\n  const winner = history[history.length - 1].playerAlive.findIndex((p) => p);\r\n  const ticks = history.map((h) => omit(h, [\"meta\"]));\r\n  const timeStamp = new Date().toISOString();\r\n  return {\r\n    ...meta,\r\n    tickCount: ticks.length,\r\n    ticks,\r\n    winner,\r\n    timeStamp,\r\n  };\r\n};\r\n","import { Alert, Button, Typography } from \"antd\";\r\nimport React from \"react\";\r\nimport { Controller } from \"../../controller/types\";\r\nimport { Game } from \"../../engine/game\";\r\nimport { GameHistory, GameOptions } from \"../../engine/types\";\r\n\r\nconst { Paragraph } = Typography;\r\n\r\nexport type RunProps = {\r\n  controllers?: Controller[];\r\n  onPrev: () => void;\r\n  onNext: () => void;\r\n  options?: GameOptions;\r\n  gameComplete: (history: GameHistory) => void;\r\n};\r\n\r\nexport enum RunStage {\r\n  UNSET,\r\n  CONTROLLER_INIT,\r\n  ERROR_STATE,\r\n  GAME_RUN,\r\n  GAME_OVER,\r\n}\r\n\r\nexport type RunState = {\r\n  errorTitle?: string;\r\n  errorDesc?: string;\r\n  game?: Game;\r\n  runStage: RunStage;\r\n  history?: GameHistory;\r\n};\r\n\r\nexport class Run extends React.Component<RunProps, RunState> {\r\n  constructor(props: RunProps) {\r\n    super(props);\r\n    this.state = {\r\n      runStage: RunStage.UNSET,\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(_: RunProps, prevState: RunState) {\r\n    if (prevState.runStage !== this.state.runStage) {\r\n      this.stateUpdate();\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { controllers, options } = this.props;\r\n\r\n    if (!controllers || !controllers.length || !options) {\r\n      this.setState({\r\n        runStage: RunStage.ERROR_STATE,\r\n        errorTitle: \"Missing controllers or options?\",\r\n        errorDesc:\r\n          JSON.stringify(controllers, null, 2) +\r\n          \"\\n\" +\r\n          JSON.stringify(options, null, 2),\r\n      });\r\n      return;\r\n    }\r\n\r\n    const game = new Game(controllers, options);\r\n    this.setState({ game, runStage: RunStage.CONTROLLER_INIT });\r\n  }\r\n\r\n  onCancel = () => {\r\n    this.props.onPrev();\r\n  };\r\n\r\n  stateUpdate = (g?: Game) => {\r\n    const { runStage, game } = this.state;\r\n    if (!game) {\r\n      this.setState({\r\n        runStage: RunStage.ERROR_STATE,\r\n        errorTitle: \"No game object available\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    switch (runStage) {\r\n      case RunStage.CONTROLLER_INIT:\r\n        game\r\n          .initControllers()\r\n          .then(() => {\r\n            this.setState({ runStage: RunStage.GAME_RUN });\r\n          })\r\n          .catch((err) => {\r\n            this.setState({\r\n              runStage: RunStage.ERROR_STATE,\r\n              errorTitle: \"Error initialising controllers\",\r\n              errorDesc: err.message,\r\n            });\r\n          });\r\n        break;\r\n      case RunStage.GAME_RUN:\r\n        game\r\n          .run()\r\n          .then((history) => {\r\n            this.props.gameComplete(history);\r\n            this.setState({\r\n              runStage: RunStage.GAME_OVER,\r\n              history,\r\n            });\r\n          })\r\n          .catch((err) => {\r\n            this.setState({\r\n              runStage: RunStage.ERROR_STATE,\r\n              errorTitle: \"Error running game\",\r\n              errorDesc: err.message,\r\n            });\r\n          });\r\n        break;\r\n    }\r\n  };\r\n\r\n  statusMessage = () => {\r\n    const { runStage, errorDesc, errorTitle } = this.state;\r\n    switch (runStage) {\r\n      case RunStage.CONTROLLER_INIT:\r\n        return <Paragraph>Initialising controllers...</Paragraph>;\r\n      case RunStage.ERROR_STATE:\r\n        return (\r\n          <Alert\r\n            message={errorTitle}\r\n            description={<pre>{errorDesc}</pre>}\r\n            type=\"error\"\r\n            showIcon\r\n          />\r\n        );\r\n      case RunStage.GAME_RUN:\r\n        return (\r\n          <>\r\n            <Paragraph>Running game...</Paragraph>\r\n            <Button onClick={this.onCancel}>Previous</Button>\r\n          </>\r\n        );\r\n      case RunStage.GAME_OVER:\r\n        return <Alert message=\"Game complete!\" type=\"success\" showIcon />;\r\n      default:\r\n        return (\r\n          <Alert message=\"Game unset!? Contact dev\" type=\"warning\" showIcon />\r\n        );\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { runStage } = this.state;\r\n    const { onNext } = this.props;\r\n    const body = this.statusMessage();\r\n\r\n    return (\r\n      <>\r\n        {body}\r\n        <br />\r\n\r\n        {runStage === RunStage.GAME_OVER ? (\r\n          <Button type=\"primary\" onClick={onNext}>\r\n            Next\r\n          </Button>\r\n        ) : (\r\n          <Button onClick={this.onCancel} danger>\r\n            Cancel\r\n          </Button>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { cloneDeep } from \"lodash\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport { Controller } from \"../controller/types\";\r\nimport { GameOptions, GameState, Move, Pos } from \"./types\";\r\nimport { gameHistorySummarise, moveToVector2d, randomPos, withinBounds } from \"./utils\";\r\n\r\nconst defaultOptions: GameOptions = {\r\n  gridSize: 50,\r\n  maxTicks: 1000,\r\n};\r\n\r\nexport class Game {\r\n  controllers: Controller[];\r\n  options: GameOptions;\r\n  gameState: GameState;\r\n  controllersReady: boolean[];\r\n\r\n  constructor(controllers: Controller[], options?: GameOptions) {\r\n    this.controllers = controllers;\r\n    this.options = { ...defaultOptions, ...options };\r\n    this.gameState = this.initState(controllers, this.options);\r\n    this.controllersReady = new Array(controllers.length).fill(false);\r\n  }\r\n\r\n  public async initControllers() {\r\n    await Promise.all(\r\n      this.controllers.map(async (c, i) => {\r\n        await c.init({\r\n          playerNumber: i,\r\n          gameId: this.gameState.meta.gameId,\r\n          gridSize: this.gameState.meta.gridSize,\r\n          playerCount: this.gameState.meta.playerCount,\r\n        });\r\n        this.controllersReady[i] = true;\r\n      })\r\n    );\r\n  }\r\n\r\n  public async run() {\r\n    if (!this.controllersReady.every((r) => r)) {\r\n      throw new Error(\r\n        \"Controllers are not ready. \" + JSON.stringify(this.controllersReady)\r\n      );\r\n    }\r\n\r\n    const allStates: GameState[] = [];\r\n    while (\r\n      this.gameState.playerAlive.filter((p) => p).length > 1 &&\r\n      this.gameState.tick < this.options.maxTicks\r\n    ) {\r\n      const copy = cloneDeep(this.gameState);\r\n      allStates.push(copy);\r\n      await this.update();\r\n    }\r\n    const copy = cloneDeep(this.gameState);\r\n    allStates.push(copy);\r\n    return gameHistorySummarise(allStates);\r\n  }\r\n\r\n  private initState(\r\n    controllers: Controller[],\r\n    options: GameOptions\r\n  ): GameState {\r\n    const playerCount = controllers.length;\r\n    const newState: GameState = {\r\n      tick: 0,\r\n      positions: [],\r\n      lastMoves: [],\r\n      food: [],\r\n      playerAlive: new Array(playerCount).fill(true),\r\n      meta: {\r\n        playerCount,\r\n        gameId: uuidv4(),\r\n        gridSize: options.gridSize,\r\n      },\r\n    };\r\n\r\n    newState.positions = this.uniquePos(newState, playerCount).map((p) => [p]);\r\n    newState.food = this.uniquePos(newState, playerCount);\r\n    return newState;\r\n  }\r\n\r\n  private uniquePos(gameState: GameState, positions: number = 1): Pos[] {\r\n    const poss: Pos[] = [];\r\n\r\n    // TODO: actually ensure unique positions\r\n    for (let i = 0; i < positions; i++) {\r\n      const p = randomPos(gameState.meta.gridSize);\r\n      poss.push(p);\r\n    }\r\n\r\n    return poss;\r\n  }\r\n\r\n  public async update() {\r\n    const controllerMoves = await Promise.all(\r\n      this.controllers.map(async (c) => await c.update(this.gameState))\r\n    );\r\n\r\n    const newState = this.apply(this.gameState, controllerMoves);\r\n    this.gameState = newState;\r\n    return this.gameState;\r\n  }\r\n\r\n  private apply(oldState: GameState, controllerMoves: Move[]): GameState {\r\n    const newState = { ...oldState };\r\n\r\n    newState.tick = oldState.tick + 1;\r\n\r\n    controllerMoves.forEach((move, player) => {\r\n      const currentHead = oldState.positions[player][0];\r\n      const moveVec = moveToVector2d(move);\r\n      const newHead = [\r\n        currentHead[0] + moveVec[0],\r\n        currentHead[1] + moveVec[1],\r\n      ] as Pos;\r\n\r\n      newState.lastMoves[player] = move;\r\n\r\n      // Check bounds collision\r\n      if (!withinBounds(newHead, newState.meta.gridSize)) {\r\n        newState.playerAlive[player] = false;\r\n        return;\r\n      }\r\n\r\n      // Check part collision\r\n      const collided = oldState.positions.some((pos) => {\r\n        return pos.some(([x, y]) => x === newHead[0] && y === newHead[1]);\r\n      });\r\n\r\n      if (collided) {\r\n        newState.playerAlive[player] = false;\r\n        return;\r\n      }\r\n\r\n      // Check food collision\r\n      const ateFood = oldState.food.some((pos) => {\r\n        if (pos[0] === newHead[0] && pos[1] === newHead[1]) {\r\n          newState.food = newState.food.filter((p) => p !== pos);\r\n          return true;\r\n        }\r\n        return false;\r\n      });\r\n\r\n      if (!ateFood) {\r\n        newState.positions[player].pop();\r\n      }\r\n      newState.positions[player].unshift(newHead);\r\n    });\r\n\r\n    // Repopulate food\r\n    newState.food.push(\r\n      ...this.uniquePos(\r\n        newState,\r\n        newState.meta.playerCount - newState.food.length\r\n      )\r\n    );\r\n\r\n    return newState;\r\n  }\r\n}\r\n","import store from \"store\";\r\nimport { GameHistory } from \"../engine/types\";\r\n\r\nexport const enum StoreKeys {\r\n  HISTORIES = \"histories\",\r\n}\r\n\r\nexport const getHistories = (): GameHistory[] => {\r\n  return store.get(StoreKeys.HISTORIES) || [];\r\n};\r\n\r\nexport const setHistories = (histories: GameHistory[]): void => {\r\n  store.set(StoreKeys.HISTORIES, histories);\r\n};\r\n\r\nexport const addHistory = (history: GameHistory): void => {\r\n  const histories = getHistories();\r\n  histories.push(history);\r\n  setHistories(histories);\r\n};\r\n\r\nexport const removeHistory = (id: string): void => {\r\n  const histories = getHistories().filter((history) => history.gameId !== id);\r\n  setHistories(histories);\r\n};\r\n","import { Button, Form, InputNumber, Space } from \"antd\";\r\nimport React, { useCallback, useEffect } from \"react\";\r\nimport { GameOptions } from \"../../engine/types\";\r\n\r\nexport type GameSetupProps = {\r\n  onConfigChange: (options: GameOptions) => void;\r\n  onNext: () => void;\r\n  onPrev: () => void;\r\n};\r\n\r\nexport const GameSetup: React.FunctionComponent<GameSetupProps> = ({\r\n  onConfigChange,\r\n  onNext,\r\n  onPrev,\r\n}) => {\r\n  const [gridSize, setGridSize] = React.useState(50);\r\n  const [maxTicks, setMaxTicks] = React.useState(1000);\r\n\r\n  const changeCallback = useCallback(() => {\r\n    onConfigChange({\r\n      gridSize,\r\n      maxTicks,\r\n    });\r\n  }, [onConfigChange, gridSize, maxTicks]);\r\n\r\n  const onMaxTicksChange = useCallback(\r\n    (value: number) => {\r\n      setMaxTicks(value);\r\n      changeCallback();\r\n    },\r\n    [changeCallback, setMaxTicks]\r\n  );\r\n\r\n  const onGridSizeChange = useCallback(\r\n    (value: number) => {\r\n      setGridSize(value);\r\n      changeCallback();\r\n    },\r\n    [changeCallback, setGridSize]\r\n  );\r\n\r\n  useEffect(() => {\r\n    onConfigChange({\r\n      gridSize,\r\n      maxTicks,\r\n    });\r\n  }, [onConfigChange, gridSize, maxTicks]);\r\n\r\n  return (\r\n    <>\r\n      <Form>\r\n        <Form.Item label=\"Max ticks\">\r\n          <InputNumber\r\n            min={100}\r\n            max={10000}\r\n            defaultValue={1000}\r\n            value={maxTicks}\r\n            onChange={onMaxTicksChange}\r\n          />\r\n        </Form.Item>\r\n\r\n        <Form.Item label=\"Grid size\">\r\n          <InputNumber\r\n            min={10}\r\n            max={1000}\r\n            defaultValue={50}\r\n            value={gridSize}\r\n            onChange={onGridSizeChange}\r\n          />\r\n        </Form.Item>\r\n      </Form>\r\n\r\n      <Space>\r\n        <Button onClick={onPrev}>Previous</Button>\r\n        <Button type=\"primary\" onClick={onNext}>\r\n          Start\r\n        </Button>\r\n      </Space>\r\n    </>\r\n  );\r\n};\r\n","import { Steps, Typography } from \"antd\";\r\nimport React, { useCallback, useState } from \"react\";\r\nimport { Controller } from \"../../controller/types\";\r\nimport { GameHistory, GameOptions } from \"../../engine/types\";\r\nimport { ControllerCreator } from \"./ControllerCreator\";\r\nimport { Run } from \"./Run\";\r\nimport { GameSetup } from \"./Setup\";\r\nimport { Summary } from \"./Summary\";\r\n\r\nconst { Step } = Steps;\r\nconst { Title } = Typography;\r\n\r\nexport type GamePageProps = {};\r\n\r\nenum SetupStage {\r\n  CONTROLLER_CREATOR,\r\n  GAME_SETUP,\r\n  PLAYING,\r\n  SUMMARY,\r\n}\r\n\r\nexport const GameRunner: React.FunctionComponent<GamePageProps> = () => {\r\n  const [currentStage, setCurrentStage] = useState(\r\n    SetupStage.CONTROLLER_CREATOR\r\n  );\r\n\r\n  const [controllers, setControllers] = useState<Controller[]>([]);\r\n  const [options, setOptions] = useState<GameOptions | undefined>();\r\n  const [gameHistory, setGameHistory] = useState<GameHistory | undefined>();\r\n\r\n  const creatorCallback = useCallback(\r\n    (controllers) => {\r\n      setControllers(controllers);\r\n    },\r\n    [setControllers]\r\n  );\r\n\r\n  const onConfigChange = useCallback(\r\n    (options) => {\r\n      setOptions(options);\r\n    },\r\n    [setOptions]\r\n  );\r\n\r\n  const completeCallback = useCallback(\r\n    (history) => {\r\n      setGameHistory(history);\r\n    },\r\n    [setGameHistory]\r\n  );\r\n\r\n  const nextCallback = useCallback(() => {\r\n    setCurrentStage((currentStage + 1) % (SetupStage.SUMMARY + 1));\r\n  }, [currentStage, setCurrentStage]);\r\n  const prevCallback = useCallback(() => {\r\n    setCurrentStage((currentStage - 1) % (SetupStage.SUMMARY + 1));\r\n  }, [currentStage, setCurrentStage]);\r\n\r\n  return (\r\n    <>\r\n      <Title>Play a Game</Title>\r\n      <Steps current={currentStage}>\r\n        <Step title=\"Controller Creator\" />\r\n        <Step title=\"Game Setup\" />\r\n        <Step title=\"Running\" />\r\n        <Step title=\"Summary\" />\r\n      </Steps>\r\n\r\n      <br />\r\n      {currentStage === SetupStage.CONTROLLER_CREATOR && (\r\n        <ControllerCreator\r\n          onControllerChange={creatorCallback}\r\n          onNext={nextCallback}\r\n        />\r\n      )}\r\n      {currentStage === SetupStage.GAME_SETUP && (\r\n        <GameSetup\r\n          onConfigChange={onConfigChange}\r\n          onNext={nextCallback}\r\n          onPrev={prevCallback}\r\n        />\r\n      )}\r\n      {currentStage === SetupStage.PLAYING && (\r\n        <Run\r\n          controllers={controllers}\r\n          options={options}\r\n          onPrev={prevCallback}\r\n          onNext={nextCallback}\r\n          gameComplete={completeCallback}\r\n        />\r\n      )}\r\n      {currentStage === SetupStage.SUMMARY && (\r\n        <Summary gameHistory={gameHistory} onNext={nextCallback} />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import { GameHistory } from \"../engine/types\";\r\n\r\nexport const createDownloadHref = (gameHistory: GameHistory) => {\r\n  const jsonBlob = new Blob([JSON.stringify(gameHistory, null, 2)], {\r\n    type: \"text/json\",\r\n  });\r\n  const href = URL.createObjectURL(jsonBlob);\r\n  const download = `${gameHistory.timeStamp}.json`;\r\n\r\n  return {\r\n    href,\r\n    download,\r\n  };\r\n};\r\n","import { Button, Collapse, Result, Typography } from \"antd\";\r\nimport React, { useCallback } from \"react\";\r\nimport { DownloadOutlined, SaveOutlined, TrophyOutlined } from \"@ant-design/icons\";\r\nimport { GameHistory } from \"../../engine/types\";\r\nimport { addHistory } from \"../../store\";\r\nimport { createDownloadHref } from \"../../store/download\";\r\n\r\nconst { Panel } = Collapse;\r\nconst { Paragraph } = Typography;\r\n\r\nexport type SummaryProps = {\r\n  gameHistory?: GameHistory;\r\n  onNext: () => void;\r\n};\r\n\r\nexport const Summary: React.FunctionComponent<SummaryProps> = (props) => {\r\n  const { gameHistory, onNext } = props;\r\n  const handleSave = useCallback(() => {\r\n    if (!gameHistory) {\r\n      return;\r\n    }\r\n    addHistory(gameHistory);\r\n  }, [gameHistory]);\r\n\r\n  if (!gameHistory) {\r\n    return <div>Error: No game history specified</div>;\r\n  }\r\n\r\n  const downloadProps = createDownloadHref(gameHistory);\r\n\r\n  return (\r\n    <>\r\n      <Result\r\n        icon={<TrophyOutlined />}\r\n        status=\"success\"\r\n        title={\"Player \" + gameHistory.winner + \" wins!\"}\r\n      />\r\n\r\n      <Button icon={<DownloadOutlined />} {...downloadProps}>\r\n        Download\r\n      </Button>\r\n      <Button icon={<SaveOutlined />} onClick={handleSave}>\r\n        Save\r\n      </Button>\r\n\r\n      <Collapse defaultActiveKey={[\"1\"]}>\r\n        <Panel header=\"Full Game History\" key=\"1\">\r\n          <Paragraph>\r\n            <pre>{JSON.stringify(gameHistory, null, 2)}</pre>\r\n          </Paragraph>\r\n        </Panel>\r\n      </Collapse>\r\n      <Button onClick={onNext}>Start Again</Button>\r\n    </>\r\n  );\r\n};\r\n","import { Typography } from \"antd\";\r\nimport React from \"react\";\r\n\r\nconst { Title, Paragraph } = Typography;\r\n\r\nexport type HomePageProps = {};\r\n\r\nexport const HomePage: React.FunctionComponent<HomePageProps> = (props) => {\r\n  return (\r\n    <>\r\n      <Title>Snake Tron - Code Fights!</Title>\r\n\r\n      <Paragraph>What, you thought there would be content?</Paragraph>\r\n    </>\r\n  );\r\n};\r\n","import { Layout } from \"antd\";\r\nimport React from \"react\";\r\n\r\nconst { Content } = Layout;\r\n\r\nexport type ContentPartProps = {};\r\n\r\nexport const ContentPart: React.FunctionComponent<ContentPartProps> = (\r\n  props\r\n) => {\r\n  return <Content className=\"content\">{props.children}</Content>;\r\n};\r\n","import React from \"react\";\r\nimport { Layout } from \"antd\";\r\n\r\nconst { Footer } = Layout;\r\n\r\nexport const FooterPart: React.FunctionComponent = () => {\r\n  return (\r\n    <Footer className=\"footer\">\r\n      Created by <a href=\"http://samuel-lewis.com/\">Samuel Lewis</a>\r\n    </Footer>\r\n  );\r\n};\r\n","import { Layout, Menu } from \"antd\";\r\nimport React from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nconst { Header } = Layout;\r\n\r\nexport const HeaderPart: React.FunctionComponent = () => {\r\n  return (\r\n    <Header className=\"header\">\r\n      <div className=\"logo\">üêçüèçÔ∏è</div>\r\n      <Menu theme=\"dark\" mode=\"horizontal\">\r\n        <Menu.Item key=\"home\">\r\n          <Link to=\"/\">Home</Link>\r\n        </Menu.Item>\r\n        <Menu.Item key=\"game\">\r\n          <Link to=\"/game\">Game</Link>\r\n        </Menu.Item>\r\n        <Menu.Item key=\"viewer\">\r\n          <Link to=\"/viewer\">Viewer</Link>\r\n        </Menu.Item>\r\n        <Menu.Item key=\"tester\">\r\n          <Link to=\"/tester\">Controller Tester</Link>\r\n        </Menu.Item>\r\n      </Menu>\r\n    </Header>\r\n  );\r\n};\r\n","import { Button, Col, Divider, Row, Tabs, Typography } from \"antd\";\r\nimport React, { useCallback, useState } from \"react\";\r\nimport { RestControllerSelector } from \"../controller/adapters/rest\";\r\nimport { Controller, InitPayload } from \"../controller/types\";\r\nimport { GameState, Move } from \"../engine/types\";\r\n\r\nconst { TabPane } = Tabs;\r\nconst { Title, Paragraph } = Typography;\r\n\r\nconst sampleIniData: InitPayload = {\r\n  playerNumber: 2,\r\n  playerCount: 4,\r\n  gameId: \"sample-test\",\r\n  gridSize: 50,\r\n};\r\n\r\nconst sampleStateData: GameState = {\r\n  tick: 2,\r\n  positions: [\r\n    [\r\n      [42, 31],\r\n      [41, 31],\r\n      [40, 31],\r\n    ],\r\n    [\r\n      [47, 27],\r\n      [47, 28],\r\n    ],\r\n  ],\r\n  lastMoves: [Move.NORTH, Move.SOUTH],\r\n  food: [\r\n    [35, 16],\r\n    [17, 6],\r\n  ],\r\n  playerAlive: [true, true],\r\n  meta: {\r\n    playerCount: 2,\r\n    gameId: \"48e2ee9e-171e-45bd-8904-a762d8e2b782\",\r\n    gridSize: 50,\r\n  },\r\n};\r\n\r\nexport type ControllerTesterPageProps = {};\r\n\r\nexport const ControllerTesterPage: React.FunctionComponent<ControllerTesterPageProps> =\r\n  () => {\r\n    const [controller, setController] = useState<Controller | null>(null);\r\n    const [response, setResponse] = useState<string>(\"\");\r\n    const [sendData, setSendData] = useState<string>(\"\");\r\n\r\n    const loaderCallback = useCallback(\r\n      (newController) => {\r\n        setController(newController);\r\n      },\r\n      [setController]\r\n    );\r\n\r\n    const gameIniButton = useCallback(() => {\r\n      setSendData(JSON.stringify(sampleIniData, null, 2));\r\n      controller\r\n        ?.init(sampleIniData)\r\n        .then((r) => setResponse(JSON.stringify(r, null, 2)))\r\n        .catch((e) => setResponse(e.message));\r\n    }, [controller, setResponse]);\r\n\r\n    const stateSendButton = useCallback(() => {\r\n      setSendData(JSON.stringify(sampleStateData, null, 2));\r\n      controller\r\n        ?.update(sampleStateData)\r\n        .then((r) => setResponse(JSON.stringify(r, null, 2)))\r\n        .catch((e) => setResponse(e.message));\r\n    }, [controller, setResponse]);\r\n\r\n    return (\r\n      <>\r\n        <Title>Controller Tester</Title>\r\n\r\n        <Tabs defaultActiveKey=\"1\">\r\n          <TabPane tab=\"Rest\" key=\"1\">\r\n            <RestControllerSelector setController={loaderCallback} />\r\n          </TabPane>\r\n        </Tabs>\r\n\r\n        <Button onClick={gameIniButton}>Test game initialise</Button>\r\n        <Button onClick={stateSendButton}>Test game update</Button>\r\n\r\n        <Row gutter={16}>\r\n          <Col span={12}>\r\n            <Divider>Sent</Divider>\r\n            <Paragraph>{sendData && <pre>{sendData}</pre>}</Paragraph>\r\n          </Col>\r\n          <Col span={12}>\r\n            <Divider>Response</Divider>\r\n            <Paragraph>{response && <pre>{response}</pre>}</Paragraph>\r\n          </Col>\r\n        </Row>\r\n      </>\r\n    );\r\n  };\r\n","import React, { useLayoutEffect, useRef } from \"react\";\r\nimport { MetalessGameState, Pos } from \"../engine/types\";\r\n\r\nconst CANVAS_SIZE = 400;\r\n\r\nexport type CanvasProps = {\r\n  state: MetalessGameState;\r\n  gridSize: number;\r\n};\r\n\r\nconst clearCanvas = (ctx: CanvasRenderingContext2D) => {\r\n  ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);\r\n  ctx.strokeRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);\r\n};\r\n\r\nfunction drawPart(\r\n  ctx: CanvasRenderingContext2D,\r\n  partSize: number,\r\n  [x, y]: Pos,\r\n  colour: string\r\n) {\r\n  ctx.fillStyle = colour;\r\n  ctx.fillRect(x * partSize, y * partSize, partSize, partSize);\r\n}\r\n\r\nfunction drawSnake(\r\n  ctx: CanvasRenderingContext2D,\r\n  partSize: number,\r\n  snake: Pos[],\r\n  player: number\r\n) {\r\n  const colour = \"red\";\r\n  snake.forEach((pos) => drawPart(ctx, partSize, pos, colour));\r\n}\r\n\r\nexport const Canvas: React.FunctionComponent<CanvasProps> = (props) => {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const { state, gridSize } = props;\r\n\r\n  useLayoutEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) {\r\n      return;\r\n    }\r\n\r\n    const partSize = CANVAS_SIZE / gridSize;\r\n\r\n    clearCanvas(ctx);\r\n\r\n    state.positions.forEach((player, i) => {\r\n      drawSnake(ctx, partSize, player, i);\r\n    });\r\n    state.food.forEach((pos) => drawPart(ctx, partSize, pos, \"green\"));\r\n  }, [canvasRef, state, gridSize]);\r\n\r\n  return <canvas width={CANVAS_SIZE} height={CANVAS_SIZE} ref={canvasRef} />;\r\n};\r\n","import { Table, Typography } from \"antd\";\r\nimport React from \"react\";\r\nimport { CheckCircleOutlined, CloseCircleOutlined } from \"@ant-design/icons\";\r\nimport { MetalessGameState } from \"../engine/types\";\r\n\r\nconst { Paragraph } = Typography;\r\n\r\nexport type StateSnapshotProps = {\r\n  frame: MetalessGameState;\r\n  viewedPlayer?: (player: number) => void;\r\n};\r\n\r\nexport const StateSnapshot: React.FunctionComponent<StateSnapshotProps> = ({\r\n  frame,\r\n}) => {\r\n  if (!frame) {\r\n    return null;\r\n  }\r\n  const playerData = new Array(frame.playerAlive.length)\r\n    .fill(null)\r\n    .map((_, i) => {\r\n      return {\r\n        key: `Player ${i}`,\r\n        name: `Player ${i}`,\r\n        alive: frame.playerAlive[i],\r\n        lastMove: frame.lastMoves[i],\r\n        position: frame.positions[i],\r\n      };\r\n    });\r\n\r\n  const columns = [\r\n    {\r\n      title: \"Name\",\r\n      dataIndex: \"name\",\r\n      key: \"name\",\r\n    },\r\n    {\r\n      title: \"Alive\",\r\n      dataIndex: \"alive\",\r\n      key: \"alive\",\r\n      render: (alive: boolean) =>\r\n        alive ? <CheckCircleOutlined /> : <CloseCircleOutlined />,\r\n    },\r\n    {\r\n      title: \"Last Move\",\r\n      dataIndex: \"lastMove\",\r\n      key: \"lastMove\",\r\n    },\r\n    {\r\n      title: \"Positions\",\r\n      dataIndex: \"position\",\r\n      key: \"position\",\r\n      render: (position: number) => JSON.stringify(position),\r\n      ellipsis: true,\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <Paragraph>Tick: {frame.tick}</Paragraph>\r\n      <Paragraph>Food: {JSON.stringify(frame.food)}</Paragraph>\r\n      <Table\r\n        size=\"small\"\r\n        dataSource={playerData}\r\n        columns={columns}\r\n        pagination={false}\r\n        expandable={{\r\n          expandedRowRender: (record) => (\r\n            <p style={{ margin: 0 }}>{JSON.stringify(record.position)}</p>\r\n          ),\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n};\r\n","import { Col, Row, Slider } from \"antd\";\r\nimport React, { useCallback, useState } from \"react\";\r\nimport { GameHistory } from \"../engine/types\";\r\nimport { Canvas } from \"./Canvas\";\r\nimport { StateSnapshot } from \"./Snapshot\";\r\n\r\nexport type ViewerProps = {\r\n  history?: GameHistory;\r\n};\r\n\r\nexport const Viewer: React.FunctionComponent<ViewerProps> = (props) => {\r\n  const { history } = props;\r\n  const [tick, setTick] = useState(0);\r\n  const sliderChange = useCallback((value) => setTick(value), [setTick]);\r\n\r\n  if (!history) {\r\n    return <div>Error: No history loaded?!</div>;\r\n  }\r\n\r\n  return (\r\n    <Row justify=\"center\">\r\n      <Col span={12}>\r\n        <Canvas state={history.ticks[tick]} gridSize={history.gridSize} />\r\n        <Slider\r\n          style={{ width: \"400px\", marginLeft: 0, marginRight: 0 }}\r\n          value={tick}\r\n          min={0}\r\n          max={history.tickCount - 1}\r\n          onChange={sliderChange}\r\n        />\r\n      </Col>\r\n      <Col span={12}>\r\n        <StateSnapshot frame={history.ticks[tick]} />\r\n      </Col>\r\n    </Row>\r\n  );\r\n};\r\n","import { Button, Divider, Table, Tooltip, Typography } from \"antd\";\r\nimport React, { useMemo, useState } from \"react\";\r\nimport { DeleteOutlined, DownloadOutlined, EyeOutlined } from \"@ant-design/icons\";\r\nimport { GameHistory } from \"../engine/types\";\r\nimport { getHistories, removeHistory } from \"../store\";\r\nimport { createDownloadHref } from \"../store/download\";\r\nimport { Viewer } from \"../viewer/Viewer\";\r\n\r\nconst { Title } = Typography;\r\n\r\nexport type ViewerPageProps = {};\r\n\r\nexport const ViewerPage: React.FunctionComponent<ViewerPageProps> = () => {\r\n  const [loadedHistory, setLoadedHistory] = useState<GameHistory | undefined>();\r\n  const [savedGames, setSavedGames] = useState<GameHistory[]>(getHistories());\r\n  const dataSource = useMemo(() => {\r\n    return savedGames.map((game) => {\r\n      const humanDate = new Date(game.timeStamp).toString();\r\n      return {\r\n        ...game,\r\n        key: game.gameId,\r\n        humanDate,\r\n      };\r\n    });\r\n  }, [savedGames]);\r\n\r\n  const columns = [\r\n    {\r\n      title: \"Timestamp\",\r\n      dataIndex: \"humanDate\",\r\n      key: \"humanDate\",\r\n      ellipsis: true,\r\n    },\r\n    {\r\n      title: \"Winner\",\r\n      dataIndex: \"winner\",\r\n      key: \"winner\",\r\n    },\r\n    {\r\n      title: \"Player Count\",\r\n      dataIndex: \"playerCount\",\r\n      key: \"playerCount\",\r\n    },\r\n    {\r\n      title: \"Tick Count\",\r\n      dataIndex: \"tickCount\",\r\n      key: \"tickCount\",\r\n    },\r\n    {\r\n      title: \"Grid Size\",\r\n      dataIndex: \"gridSize\",\r\n      key: \"gridSize\",\r\n    },\r\n    {\r\n      title: \"ID\",\r\n      dataIndex: \"gameId\",\r\n      key: \"gameId\",\r\n      ellipsis: true,\r\n    },\r\n    {\r\n      title: \"Actions\",\r\n      key: \"actions\",\r\n      render: (_: any, record: any) => {\r\n        const { key, humanDate, ...rest } = record;\r\n        const downloadProps = createDownloadHref(rest);\r\n        return (\r\n          <>\r\n            <Tooltip title=\"View\">\r\n              <Button\r\n                onClick={() => setLoadedHistory(record)}\r\n                icon={<EyeOutlined />}\r\n              />\r\n            </Tooltip>\r\n\r\n            <Tooltip title=\"Download\">\r\n              <Button icon={<DownloadOutlined />} {...downloadProps} />\r\n            </Tooltip>\r\n            <Tooltip title=\"Delete\">\r\n              <Button\r\n                onClick={() => {\r\n                  removeHistory(record.gameId);\r\n                  setSavedGames(getHistories());\r\n                }}\r\n                icon={<DeleteOutlined />}\r\n              />\r\n            </Tooltip>\r\n          </>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <Title>Game Viewer</Title>\r\n\r\n      {loadedHistory && <Viewer history={loadedHistory} />}\r\n\r\n      <Divider>Saved Rounds</Divider>\r\n      <Table dataSource={dataSource} columns={columns} />\r\n    </>\r\n  );\r\n};\r\n","import \"antd/dist/antd.css\";\nimport \"./App.less\";\nimport { Layout } from \"antd\";\nimport { Route, Switch } from \"react-router-dom\";\nimport { GameRunner } from \"./pages/game/GameRunner\";\nimport { HomePage } from \"./pages/Home\";\nimport { ContentPart } from \"./pages/parts/Content\";\nimport { FooterPart } from \"./pages/parts/Footer\";\nimport { HeaderPart } from \"./pages/parts/Header\";\nimport { ControllerTesterPage } from \"./pages/Tester\";\nimport { ViewerPage } from \"./pages/Viewer\";\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Layout className=\"layout\">\n        <HeaderPart />\n        <ContentPart>\n          <Switch>\n            <Route exact path=\"/\">\n              <HomePage />\n            </Route>\n            <Route path=\"/game\">\n              <GameRunner />\n            </Route>\n            <Route path=\"/viewer\">\n              <ViewerPage />\n            </Route>\n            <Route path=\"/tester\">\n              <ControllerTesterPage />\n            </Route>\n          </Switch>\n        </ContentPart>\n        <FooterPart />\n      </Layout>\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { HashRouter } from \"react-router-dom\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n      <App />\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}