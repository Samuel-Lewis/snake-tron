(this["webpackJsonpsnake-tron"]=this["webpackJsonpsnake-tron"]||[]).push([[0],{168:function(e,t,n){},259:function(e,t,n){"use strict";n.r(t);var r,a=n(0),c=n.n(a),s=n(25),i=n.n(s),o=n(56),l=(n(167),n(168),n(262)),u=n(24),j=n(33),O=n(269),h=n(268),b=n(267),d=n(155),f=n(31),p=n.n(f),x=n(53),m=n(71),g=n(271),v=n(124),S=n.n(v),C=n(278),y=n(6),R={"Access-Control-Allow-Origin":"*"},T=function e(t){var n=this;Object(m.a)(this,e),this.url=void 0,this.init=function(){var e=Object(x.a)(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.post(n.url,t,{headers:R});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.update=function(){var e=Object(x.a)(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.post(n.url,t,{headers:R});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.url=t},E=function(e){var t=e.setController,n=e.position,r=Object(a.useCallback)((function(e){var n=new T(e.target.value);t(n)}),[t]);return Object(y.jsx)(b.a.Item,{label:"Address",name:n,children:Object(y.jsx)(g.a,{prefix:Object(y.jsx)(C.a,{}),onChange:r})})},k=function(e){return!!e},N=function(e){var t=e.onControllerChange,n=e.onNext,r=Object(a.useMemo)((function(){return[]}),[]),c=Object(a.useCallback)((function(e){return function(n){r[e]=n,t(r.filter(k))}}),[t,r]);return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(b.a,{children:[Object(y.jsx)(E,{setController:c(0)}),Object(y.jsx)(E,{setController:c(1)})]}),Object(y.jsx)(d.a,{type:"primary",onClick:n,children:"Next"})]})},A=n(110),w=n(160),M=n(156),I=n(276),_=n(157),P=n(66),G=n(111),U=n(274),L=n(67);!function(e){e.NORTH="N",e.SOUTH="S",e.EAST="E",e.WEST="W"}(r||(r={}));var z,F=function(e){return[Math.floor(Math.random()*e),Math.floor(Math.random()*e)]},H=function(e){if(0===e.length)return{error:!0,errorMessage:"No moves made"};var t=e[0].meta,n=e[e.length-1].playerAlive.findIndex((function(e){return e})),r=e.map((function(e){return Object(G.omit)(e,["meta"])}));return Object(P.a)(Object(P.a)({},t),{},{tickCount:r.length,ticks:r,winner:n,error:!1})},J={gridSize:50,maxTicks:1e3},V=function(){function e(t,n){Object(m.a)(this,e),this.controllers=void 0,this.options=void 0,this.gameState=void 0,this.controllersReady=void 0,this.controllers=t,this.options=Object(P.a)(Object(P.a)({},J),n),this.gameState=this.initState(t,this.options),this.controllersReady=new Array(t.length).fill(!1)}return Object(A.a)(e,[{key:"initControllers",value:function(){var e=Object(x.a)(p.a.mark((function e(){var t=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.controllers.map(function(){var e=Object(x.a)(p.a.mark((function e(n,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.init({playerNumber:r,gameId:t.gameState.meta.gameId,gridSize:t.gameState.meta.gridSize,playerCount:t.gameState.meta.playerCount});case 2:t.controllersReady[r]=!0;case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Object(x.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.controllersReady.every((function(e){return e}))){e.next=2;break}throw new Error("Controllers are not ready. "+JSON.stringify(this.controllersReady));case 2:t=[];case 3:if(!(this.gameState.playerAlive.filter((function(e){return e})).length>1&&this.gameState.tick<this.options.maxTicks)){e.next=12;break}return e.t0=G.cloneDeep,e.next=7,this.update();case 7:e.t1=e.sent,n=(0,e.t0)(e.t1),t.push(n),e.next=3;break;case 12:return e.abrupt("return",H(t));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initState",value:function(e,t){var n=e.length,r={tick:0,positions:[],lastMoves:[],food:[],playerAlive:new Array(n).fill(!0),meta:{playerCount:n,gameId:Object(U.a)(),gridSize:t.gridSize}};return r.positions=this.uniquePos(r,n).map((function(e){return[e]})),r.food=this.uniquePos(r,n),r}},{key:"uniquePos",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=0;r<t;r++){var a=F(e.meta.gridSize);n.push(a)}return n}},{key:"update",value:function(){var e=Object(x.a)(p.a.mark((function e(){var t,n,r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.controllers.map(function(){var e=Object(x.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.update(r.gameState);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return t=e.sent,n=this.apply(this.gameState,t),this.gameState=n,e.abrupt("return",this.gameState);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"apply",value:function(e,t){var n,a=Object(P.a)({},e);return a.tick=e.tick+1,t.forEach((function(t,n){var c,s,i=e.positions[n][0],o=function(e){var t;return(t={},Object(L.a)(t,r.NORTH,[0,-1]),Object(L.a)(t,r.SOUTH,[0,1]),Object(L.a)(t,r.EAST,[1,0]),Object(L.a)(t,r.WEST,[-1,0]),t)[e]}(t),l=[i[0]+o[0],i[1]+o[1]];(a.lastMoves[n]=t,c=l,s=a.meta.gridSize,c.every((function(e){return e>=0&&e<s})))?e.positions.some((function(e){return e.some((function(e){var t=Object(j.a)(e,2),n=t[0],r=t[1];return n===l[0]&&r===l[1]}))}))?a.playerAlive[n]=!1:(e.food.some((function(e){return e[0]===l[0]&&e[1]===l[1]&&(a.food=a.food.filter((function(t){return t!==e})),!0)}))||a.positions[n].pop(),a.positions[n].unshift(l)):a.playerAlive[n]=!1})),(n=a.food).push.apply(n,Object(_.a)(this.uniquePos(a,a.meta.playerCount-a.food.length))),a}}]),e}(),Y=h.a.Paragraph;!function(e){e[e.UNSET=0]="UNSET",e[e.CONTROLLER_INIT=1]="CONTROLLER_INIT",e[e.ERROR_STATE=2]="ERROR_STATE",e[e.GAME_RUN=3]="GAME_RUN",e[e.GAME_OVER=4]="GAME_OVER"}(z||(z={}));var D,W=function(e){Object(w.a)(n,e);var t=Object(M.a)(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).onCancel=function(){r.props.onPrev()},r.stateUpdate=function(e){console.log("stateUpdate",e);var t=r.state,n=t.runStage,a=t.game;if(a)switch(n){case z.CONTROLLER_INIT:a.initControllers().then((function(){r.setState({runStage:z.GAME_RUN})})).catch((function(e){r.setState({runStage:z.ERROR_STATE,errorTitle:"Error initialising controllers",errorDesc:e.message})}));break;case z.GAME_RUN:a.run().then((function(e){r.props.gameComplete(e),r.setState({runStage:z.GAME_OVER,history:e})})).catch((function(e){r.setState({runStage:z.ERROR_STATE,errorTitle:"Error running game",errorDesc:e.message})}))}else r.setState({runStage:z.ERROR_STATE,errorTitle:"No game object available"})},r.statusMessage=function(){var e=r.state,t=e.runStage,n=e.errorDesc,a=e.errorTitle;switch(t){case z.CONTROLLER_INIT:return Object(y.jsx)(Y,{children:"Initialising controllers..."});case z.ERROR_STATE:return Object(y.jsx)(I.a,{message:a,description:Object(y.jsx)("pre",{children:n}),type:"error",showIcon:!0});case z.GAME_RUN:return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(Y,{children:"Running game..."}),Object(y.jsx)(d.a,{onClick:r.onCancel,children:"Previous"})]});case z.GAME_OVER:return Object(y.jsx)(I.a,{message:"Game complete!",type:"success",showIcon:!0});default:return Object(y.jsx)(I.a,{message:"Game unset!? Contact dev",type:"warning",showIcon:!0})}},r.state={runStage:z.UNSET},r}return Object(A.a)(n,[{key:"componentDidUpdate",value:function(e,t){t.runStage!==this.state.runStage&&this.stateUpdate()}},{key:"componentDidMount",value:function(){var e=this.props,t=e.controllers,n=e.options;if(t&&t.length&&n){var r=new V(t,n);this.setState({game:r,runStage:z.CONTROLLER_INIT})}else this.setState({runStage:z.ERROR_STATE,errorTitle:"Missing controllers or options?",errorDesc:JSON.stringify(t,null,2)+"\n"+JSON.stringify(n,null,2)})}},{key:"render",value:function(){var e=this.state.runStage,t=this.props.onNext,n=this.statusMessage();return Object(y.jsxs)(y.Fragment,{children:[n,Object(y.jsx)("br",{}),e===z.GAME_OVER?Object(y.jsx)(d.a,{type:"primary",onClick:t,children:"Next"}):Object(y.jsx)(d.a,{onClick:this.onCancel,danger:!0,children:"Cancel"})]})}}]),n}(c.a.Component),q=n(270),K=n(277),B=function(e){var t=e.onConfigChange,n=e.onNext,r=e.onPrev,s=c.a.useState(50),i=Object(j.a)(s,2),o=i[0],l=i[1],u=c.a.useState(1e3),O=Object(j.a)(u,2),h=O[0],f=O[1],p=Object(a.useCallback)((function(){t({gridSize:o,maxTicks:h})}),[t,o,h]),x=Object(a.useCallback)((function(e){f(e),p()}),[p,f]),m=Object(a.useCallback)((function(e){l(e),p()}),[p,l]);return Object(a.useEffect)((function(){t({gridSize:o,maxTicks:h})}),[t,o,h]),Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(b.a,{children:[Object(y.jsx)(b.a.Item,{label:"Max ticks",children:Object(y.jsx)(q.a,{min:100,max:1e4,defaultValue:1e3,value:h,onChange:x})}),Object(y.jsx)(b.a.Item,{label:"Grid size",children:Object(y.jsx)(q.a,{min:10,max:1e3,defaultValue:50,value:o,onChange:m})})]}),Object(y.jsxs)(K.b,{children:[Object(y.jsx)(d.a,{onClick:r,children:"Previous"}),Object(y.jsx)(d.a,{type:"primary",onClick:n,children:"Start"})]})]})},Q=n(272),X=n(273),Z=n(279),$=Q.a.Panel,ee=h.a.Paragraph,te=function(e){var t=e.gameHistory,n=e.onNext;return t?t.error?Object(y.jsxs)("div",{children:["Error: ",t.errorMessage]}):Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(X.a,{icon:Object(y.jsx)(Z.a,{}),status:"success",title:"Player "+t.winner+" wins!"}),Object(y.jsx)(Q.a,{defaultActiveKey:["1"],children:Object(y.jsx)($,{header:"Full Game History",children:Object(y.jsx)(ee,{children:Object(y.jsx)("pre",{children:JSON.stringify(t,null,2)})})},"1")}),Object(y.jsx)(d.a,{onClick:n,children:"Start Again"})]}):Object(y.jsx)("div",{children:"No game history??"})},ne=O.a.Step,re=h.a.Title;!function(e){e[e.CONTROLLER_CREATOR=0]="CONTROLLER_CREATOR",e[e.GAME_SETUP=1]="GAME_SETUP",e[e.PLAYING=2]="PLAYING",e[e.SUMMARY=3]="SUMMARY"}(D||(D={}));var ae=function(){var e=Object(a.useState)(D.CONTROLLER_CREATOR),t=Object(j.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)([]),s=Object(j.a)(c,2),i=s[0],o=s[1],l=Object(a.useState)(),u=Object(j.a)(l,2),h=u[0],b=u[1],d=Object(a.useState)(),f=Object(j.a)(d,2),p=f[0],x=f[1],m=Object(a.useCallback)((function(e){o(e)}),[o]),g=Object(a.useCallback)((function(e){b(e)}),[b]),v=Object(a.useCallback)((function(e){x(e)}),[x]),S=Object(a.useCallback)((function(){r((n+1)%(D.SUMMARY+1))}),[n,r]),C=Object(a.useCallback)((function(){r((n-1)%(D.SUMMARY+1))}),[n,r]);return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(re,{children:"Play a Game"}),Object(y.jsxs)(O.a,{current:n,children:[Object(y.jsx)(ne,{title:"Controller Creator"}),Object(y.jsx)(ne,{title:"Game Setup"}),Object(y.jsx)(ne,{title:"Running"}),Object(y.jsx)(ne,{title:"Summary"})]}),Object(y.jsx)("br",{}),n===D.CONTROLLER_CREATOR&&Object(y.jsx)(N,{onControllerChange:m,onNext:S}),n===D.GAME_SETUP&&Object(y.jsx)(B,{onConfigChange:g,onNext:S,onPrev:C}),n===D.PLAYING&&Object(y.jsx)(W,{controllers:i,options:h,onPrev:C,onNext:S,gameComplete:v}),n===D.SUMMARY&&Object(y.jsx)(te,{gameHistory:p,onNext:S})]})},ce=h.a.Title,se=h.a.Paragraph,ie=function(e){return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(ce,{children:"Snake Tron - Code Fights!"}),Object(y.jsx)(se,{children:"What, you thought there would be content?"})]})},oe=l.a.Content,le=function(e){return Object(y.jsx)(oe,{className:"content",children:e.children})},ue=l.a.Footer,je=function(){return Object(y.jsxs)(ue,{className:"footer",children:["Created by ",Object(y.jsx)("a",{href:"http://samuel-lewis.com/",children:"Samuel Lewis"})]})},Oe=n(275),he=l.a.Header,be=function(){return Object(y.jsxs)(he,{className:"header",children:[Object(y.jsx)("div",{className:"logo",children:"\ud83d\udc0d\ud83c\udfcd\ufe0f"}),Object(y.jsxs)(Oe.a,{theme:"dark",mode:"horizontal",children:[Object(y.jsx)(Oe.a.Item,{children:Object(y.jsx)(o.b,{to:"/",children:"Home"})},"home"),Object(y.jsx)(Oe.a.Item,{children:Object(y.jsx)(o.b,{to:"/game",children:"Game"})},"game"),Object(y.jsx)(Oe.a.Item,{children:Object(y.jsx)(o.b,{to:"/viewer",children:"Viewer"})},"viewer"),Object(y.jsx)(Oe.a.Item,{children:Object(y.jsx)(o.b,{to:"/tester",children:"Controller Tester"})},"tester")]})]})},de=n(266),fe=n(263),pe=n(264),xe=n(265),me=de.a.TabPane,ge=h.a.Title,ve=h.a.Paragraph,Se={playerNumber:2,playerCount:4,gameId:"sample-test",gridSize:50},Ce={tick:2,positions:[[[42,31],[41,31],[40,31]],[[47,27],[47,28]]],lastMoves:[r.NORTH,r.SOUTH],food:[[35,16],[17,6]],playerAlive:[!0,!0],meta:{playerCount:2,gameId:"48e2ee9e-171e-45bd-8904-a762d8e2b782",gridSize:50}},ye=function(){var e=Object(a.useState)(null),t=Object(j.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(""),s=Object(j.a)(c,2),i=s[0],o=s[1],l=Object(a.useState)(""),u=Object(j.a)(l,2),O=u[0],h=u[1],b=Object(a.useCallback)((function(e){r(e)}),[r]),f=Object(a.useCallback)((function(){h(JSON.stringify(Se,null,2)),null===n||void 0===n||n.init(Se).then((function(e){return o(JSON.stringify(e,null,2))})).catch((function(e){return o(e.message)}))}),[n,o]),p=Object(a.useCallback)((function(){h(JSON.stringify(Ce,null,2)),null===n||void 0===n||n.update(Ce).then((function(e){return o(JSON.stringify(e,null,2))})).catch((function(e){return o(e.message)}))}),[n,o]);return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(ge,{children:"Controller Tester"}),Object(y.jsx)(de.a,{defaultActiveKey:"1",children:Object(y.jsx)(me,{tab:"Rest",children:Object(y.jsx)(E,{setController:b})},"1")}),Object(y.jsx)(d.a,{onClick:f,children:"Test game initialise"}),Object(y.jsx)(d.a,{onClick:p,children:"Test game update"}),Object(y.jsxs)(fe.a,{gutter:16,children:[Object(y.jsxs)(pe.a,{span:12,children:[Object(y.jsx)(xe.a,{children:"Sent"}),Object(y.jsx)(ve,{children:O&&Object(y.jsx)("pre",{children:O})})]}),Object(y.jsxs)(pe.a,{span:12,children:[Object(y.jsx)(xe.a,{children:"Response"}),Object(y.jsx)(ve,{children:i&&Object(y.jsx)("pre",{children:i})})]})]})]})},Re=h.a.Title,Te=h.a.Paragraph,Ee=function(){return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(Re,{children:"Game Viewer"}),Object(y.jsx)(Te,{children:"What, you thought there would be content?"})]})};var ke=function(){return Object(y.jsx)("div",{className:"App",children:Object(y.jsxs)(l.a,{className:"layout",children:[Object(y.jsx)(be,{}),Object(y.jsx)(le,{children:Object(y.jsxs)(u.c,{children:[Object(y.jsx)(u.a,{exact:!0,path:"/",children:Object(y.jsx)(ie,{})}),Object(y.jsx)(u.a,{path:"/game",children:Object(y.jsx)(ae,{})}),Object(y.jsx)(u.a,{path:"/viewer",children:Object(y.jsx)(Ee,{})}),Object(y.jsx)(u.a,{path:"/tester",children:Object(y.jsx)(ye,{})})]})}),Object(y.jsx)(je,{})]})})};i.a.render(Object(y.jsx)(c.a.StrictMode,{children:Object(y.jsx)(o.a,{children:Object(y.jsx)(ke,{})})}),document.getElementById("root"))}},[[259,1,2]]]);
//# sourceMappingURL=main.d2875bf2.chunk.js.map