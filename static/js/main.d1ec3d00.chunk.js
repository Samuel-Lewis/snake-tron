(this["webpackJsonpsnake-tron"]=this["webpackJsonpsnake-tron"]||[]).push([[0],{210:function(e,t,n){},316:function(e,t,n){"use strict";n.r(t);var r,a,c=n(0),i=n.n(c),s=n(24),o=n.n(s),l=n(50),u=(n(209),n(210),n(320)),j=n(30),b=n(6),O=function(){return Object(b.jsx)(b.Fragment,{children:"What, you thought there would be content?"})},d=n(26),f=n(334),h=n(325),p=n(194),m=n(335),x=n(46),g=n(324),v=n(319),y=n(54),S=n(62),k=n(339),R=n(201),T=n(33),C=n.n(T),E=n(27),I=n(59),N=n(74),w=n(331),A=n(151),M=n.n(A),P=n(338),U={headers:{"Access-Control-Allow-Origin":"*"},timeout:2e3},D=function e(t){var n=this;Object(N.a)(this,e),this.url=void 0,this.init=function(){var e=Object(I.a)(C.a.mark((function e(t){var r,a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={playerNumber:t.playerNumber},e.next=3,M.a.post(n.url+"/init",t,Object(E.a)(Object(E.a)({},U),{},{params:r}));case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.update=function(){var e=Object(I.a)(C.a.mark((function e(t,r){var a,c;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={playerNumber:r},e.next=3,M.a.post(n.url+"/update",t,Object(E.a)(Object(E.a)({},U),{},{params:a}));case 3:return c=e.sent,e.abrupt("return",c.data);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.end=function(){var e=Object(I.a)(C.a.mark((function e(t,r){var a,c;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={playerNumber:r},e.next=3,M.a.post(n.url+"/end",t,Object(E.a)(Object(E.a)({},U),{},{params:a}));case 3:return c=e.sent,e.abrupt("return",c.data);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.url=t},_={Selector:function(e){var t=e.onChange,n=Object(c.useCallback)((function(e){t&&t(e.target.value)}),[t]);return Object(b.jsx)(g.a.Item,{label:"Address",children:Object(b.jsx)(w.a,{prefix:Object(b.jsx)(P.a,{}),onChange:n})})},create:function(e){return new D(e)},label:"REST"},G=function(e){return!!e},L=[_],z=function(e){var t=e.onControllerChange,n=e.onNext,r=Object(c.useState)([]),a=Object(d.a)(r,2),i=a[0],s=a[1],o=Object(c.useMemo)((function(){return[]}),[]),l=Object(c.useCallback)((function(e){return function(n){o[e]=i[e].factory.create(n),t(o.filter(G))}}),[t,o,i]),u=Object(c.useMemo)((function(){return i.map((function(e,n){var r=e.key,a=e.factory;return Object(b.jsxs)(m.b,{style:{display:"flex"},align:"baseline",children:[Object(b.jsx)(a.Selector,{onChange:l(n)}),Object(b.jsx)(x.a,{type:"text",icon:Object(b.jsx)(k.a,{}),onClick:function(){s(i.filter((function(e){return e.key!==r}))),o[n]=void 0,t(o.filter(G))}})]},r)}))}),[i,s,o,l,t]),j=Object(c.useMemo)((function(){return L.map((function(e,t){return Object(b.jsxs)(x.a,{type:"dashed",icon:Object(b.jsx)(R.a,{}),onClick:function(){s([].concat(Object(p.a)(i),[{key:Object(S.uniqueId)(e.label),factory:e}]))},children:["Add ",e.label," controller"]},t)}))}),[i,s]);return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(g.a,{children:u}),Object(b.jsx)(m.b,{children:j}),Object(b.jsx)(v.a,{}),Object(b.jsx)(y.a,{title:"You must specifiy at least 2 controllers",placement:"right",children:Object(b.jsx)(x.a,{type:"primary",onClick:n,disabled:o.length<2,children:"Next"})})]})},H=n(143),F=n(202),W=n(193),J=n(336),V=n(191),Y=n(197),q=n(333);!function(e){e.DRAW="DRAW",e.WINNER="WINNER",e.TIMEOUT="TIMEOUT"}(r||(r={})),function(e){e.NORTH="N",e.SOUTH="S",e.EAST="E",e.WEST="W",e.NOP="X"}(a||(a={}));var B,K=function(e){return Array.isArray(e)&&2===e.length},X=function e(t){var n=this;Object(N.a)(this,e),this.gameState=void 0,this.pool=void 0,this.generatePool=function(){var e=n.gameState,t=e.positions,r=e.meta,a=e.food,c=r.gridSize,i=Object(S.flatten)(t).concat(a);return new Array(c*c).fill(0).map((function(e,t){return[t%c,Math.floor(t/c)]})).filter((function(e){return!i.some((function(t){return Object(S.isEqual)(t,e)}))})).filter(K)},this.next=function(){var e=Math.floor(Math.random()*n.pool.length);return n.pool.splice(e,1)[0]},this.empty=function(){return 0===n.pool.length},this.gameState=t,this.pool=this.generatePool()},Q=n(67),Z=function(e){var t=e[e.length-1],n=t.meta,a=t.playerAlive.filter((function(e){return e})).length,c=a>1?r.TIMEOUT:1===a?r.WINNER:r.DRAW,i=null;c===r.WINNER&&(i=t.playerAlive.findIndex((function(e){return e})));var s=e.map((function(e){return Object(S.omit)(e,["meta"])})),o=(new Date).toISOString();return Object(E.a)(Object(E.a)({},n),{},{tickCount:s.length,ticks:s,winner:i,timeStamp:o,result:c})},$={gridSize:50,maxTicks:1e3},ee=function(){function e(t,n,r){Object(N.a)(this,e),this.controllers=void 0,this.options=void 0,this.gameState=void 0,this.controllersReady=void 0,this.onGameTick=void 0,this.controllers=t,this.options=Object(E.a)(Object(E.a)({},$),n),this.gameState=this.initState(t,this.options),this.controllersReady=new Array(t.length).fill(!1),this.onGameTick=null!==r&&void 0!==r?r:function(){}}return Object(H.a)(e,[{key:"initControllers",value:function(){var e=Object(I.a)(C.a.mark((function e(){var t=this;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.controllers.map(function(){var e=Object(I.a)(C.a.mark((function e(n,r){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.init({playerNumber:r,gameId:t.gameState.meta.gameId,gridSize:t.gameState.meta.gridSize,playerCount:t.gameState.meta.playerCount});case 2:t.controllersReady[r]=!0;case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Object(I.a)(C.a.mark((function e(){var t,n,r,a=this;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.controllersReady.every((function(e){return e}))){e.next=2;break}throw new Error("Controllers are not ready. "+JSON.stringify(this.controllersReady));case 2:t=[];case 3:if(!(this.gameState.playerAlive.filter((function(e){return e})).length>1&&this.gameState.tick<this.options.maxTicks)){e.next=11;break}return n=Object(S.cloneDeep)(this.gameState),t.push(n),e.next=8,this.update();case 8:this.onGameTick(this.gameState.tick),e.next=3;break;case 11:return r=Object(S.cloneDeep)(this.gameState),t.push(r),this.onGameTick(this.gameState.tick),e.next=16,Promise.all(this.controllers.map(function(){var e=Object(I.a)(C.a.mark((function e(t,n){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.end(a.gameState,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 16:return e.abrupt("return",Z(t));case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initState",value:function(e,t){var n=e.length,r={tick:0,positions:[],lastMoves:[],food:[],playerAlive:new Array(n).fill(!0),meta:{playerCount:n,gameId:Object(q.a)(),gridSize:t.gridSize}},a=new X(r);return r.positions=new Array(n).fill(null).map((function(){return[a.next()]})),r.food=new Array(n).fill(null).map((function(){return a.next()})),r}},{key:"update",value:function(){var e=Object(I.a)(C.a.mark((function e(){var t,n,r=this;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.controllers.map(function(){var e=Object(I.a)(C.a.mark((function e(t,n){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.gameState.playerAlive[n]){e.next=6;break}return e.next=3,t.update(r.gameState,n).catch((function(){return null}));case 3:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",a.NOP);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:return t=e.sent,n=this.apply(this.gameState,t),this.gameState=n,e.abrupt("return",this.gameState);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"apply",value:function(e,t){var n=Object(E.a)({},e);n.tick=e.tick+1;var r=t.map((function(t,r){if(t===a.NOP)return n.playerAlive[r]=!1,null;if(null===t)return Y.a.error({message:"Player ".concat(r," disqualified"),description:"Player ".concat(r," has been disqualified. Either the controller has crashed or it returned an invalid move."),duration:0}),n.playerAlive[r]=!1,null;if(!e.playerAlive[r])return null;n.lastMoves[r]=t;var c=e.positions[r][0],i=function(e){var t;return(t={},Object(Q.a)(t,a.NORTH,[0,-1]),Object(Q.a)(t,a.SOUTH,[0,1]),Object(Q.a)(t,a.EAST,[1,0]),Object(Q.a)(t,a.WEST,[-1,0]),t)[e]}(t);return[c[0]+i[0],c[1]+i[1]]}));r.forEach((function(e,t){var r,a;null!==e&&(r=e,a=n.meta.gridSize,r.every((function(e){return e>=0&&e<a}))||(n.playerAlive[t]=!1))})),r.forEach((function(e,t){null!==e&&(r.filter((function(t){return null!==t&&t[0]===e[0]&&t[1]===e[1]})).filter(K).length>1&&(n.playerAlive[t]=!1))}));var c=new Set;r.forEach((function(e,t){if(null!==e){var r=n.food.findIndex((function(t){return null!==t&&t[0]===e[0]&&t[1]===e[1]}));-1!==r?c.add(r):n.positions[t].pop()}}));var i=n.positions.flat();r.forEach((function(e,t){null!==e&&(-1!==i.findIndex((function(t){return null!==t&&t[0]===e[0]&&t[1]===e[1]}))&&(n.playerAlive[t]=!1))})),r.forEach((function(e,t){null!==e&&n.positions[t].unshift(e)}));var s=new X(n);return n.food=n.food.map((function(e,t){if(c.has(t)){if(s.empty())return;return s.next()}return e})).filter(K),n}}]),e}(),te=h.a.Title;!function(e){e[e.UNSET=0]="UNSET",e[e.CONTROLLER_INIT=1]="CONTROLLER_INIT",e[e.ERROR_STATE=2]="ERROR_STATE",e[e.GAME_RUN=3]="GAME_RUN",e[e.GAME_OVER=4]="GAME_OVER"}(B||(B={}));var ne,re=function(e){Object(F.a)(n,e);var t=Object(W.a)(n);function n(e){var r;return Object(N.a)(this,n),(r=t.call(this,e)).onTickUpdate=function(e){var t=r.props.options;if(t){var n=Math.round(e/t.maxTicks*100);r.setState({tickProgress:n})}},r.onCancel=function(){r.props.onPrev()},r.stateUpdate=function(e){var t=r.state,n=t.runStage,a=t.game;if(a)switch(n){case B.CONTROLLER_INIT:a.initControllers().then((function(){r.setState({runStage:B.GAME_RUN})})).catch((function(e){r.setState({runStage:B.ERROR_STATE,errorTitle:"Error initialising controllers",errorDesc:e.message})}));break;case B.GAME_RUN:a.run().then((function(e){r.props.gameComplete(e),r.setState({runStage:B.GAME_OVER,history:e}),r.props.onNext()})).catch((function(e){r.setState({runStage:B.ERROR_STATE,errorTitle:"Error running game",errorDesc:e.message})}))}else r.setState({runStage:B.ERROR_STATE,errorTitle:"No game object available"})},r.statusMessage=function(){var e=r.state,t=e.runStage,n=e.errorDesc,a=e.errorTitle;switch(t){case B.CONTROLLER_INIT:return Object(b.jsx)(te,{level:3,children:"Initialising controllers..."});case B.ERROR_STATE:return Object(b.jsx)(J.a,{message:a,description:Object(b.jsx)("pre",{children:n}),type:"error",showIcon:!0});case B.GAME_RUN:return Object(b.jsx)(te,{level:3,children:"Running..."});case B.GAME_OVER:return Object(b.jsx)(te,{level:3,children:"Game complete!"});default:return Object(b.jsx)(J.a,{message:"Game unset!? Contact dev",type:"warning",showIcon:!0})}},r.state={runStage:B.UNSET,tickProgress:0},r}return Object(H.a)(n,[{key:"componentDidUpdate",value:function(e,t){t.runStage!==this.state.runStage&&this.stateUpdate()}},{key:"componentDidMount",value:function(){var e=this.props,t=e.controllers,n=e.options;if(t&&t.length&&n){var r=new ee(t,n,this.onTickUpdate);this.setState({game:r,runStage:B.CONTROLLER_INIT})}else this.setState({runStage:B.ERROR_STATE,errorTitle:"Missing controllers or options?",errorDesc:JSON.stringify(t,null,2)+"\n"+JSON.stringify(n,null,2)})}},{key:"render",value:function(){var e=this.statusMessage(),t=this.state,n=t.tickProgress,r=t.runStage,a="normal";return r===B.GAME_RUN?a="active":r===B.GAME_OVER?a="success":r===B.ERROR_STATE&&(a="exception"),Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)(m.b,{direction:"vertical",style:{width:"100%",justifyContent:"center",alignItems:"center"},children:[e,Object(b.jsx)(V.a,{type:"circle",percent:n,status:a}),Object(b.jsx)("br",{}),Object(b.jsx)(x.a,{size:"large",onClick:this.onCancel,danger:!0,children:"Cancel"})]})})}}]),n}(i.a.Component),ae=n(328),ce=function(e){var t=e.onConfigChange,n=e.onNext,r=e.onPrev,a=i.a.useState(50),s=Object(d.a)(a,2),o=s[0],l=s[1],u=i.a.useState(1e3),j=Object(d.a)(u,2),O=j[0],f=j[1],h=Object(c.useCallback)((function(){t({gridSize:o,maxTicks:O})}),[t,o,O]),p=Object(c.useCallback)((function(e){f(e),h()}),[h,f]),v=Object(c.useCallback)((function(e){l(e),h()}),[h,l]);return Object(c.useEffect)((function(){t({gridSize:o,maxTicks:O})}),[t,o,O]),Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)(g.a,{children:[Object(b.jsx)(g.a.Item,{label:"Max ticks",children:Object(b.jsx)(ae.a,{min:1,max:1e4,defaultValue:1e3,value:O,onChange:p})}),Object(b.jsx)(g.a.Item,{label:"Grid size",children:Object(b.jsx)(ae.a,{min:10,max:1e3,defaultValue:50,value:o,onChange:v})})]}),Object(b.jsxs)(m.b,{children:[Object(b.jsx)(x.a,{onClick:r,children:"Previous"}),Object(b.jsx)(x.a,{type:"primary",onClick:n,children:"Start"})]})]})},ie=n(330),se=n(332),oe=n(340),le=n(341),ue=n(342),je=n(200),be=n(343),Oe=n(93),de=n.n(Oe);!function(e){e.HISTORIES="histories"}(ne||(ne={}));var fe,he=function(){var e=de.a.get(ne.HISTORIES)||{};return Object.values(e).sort((function(e,t){return new Date(e.timeStamp).valueOf()-new Date(t.timeStamp).valueOf()}))},pe=function(e){var t=new Blob([JSON.stringify(e,null,2)],{type:"text/json"});return{href:URL.createObjectURL(t),download:"".concat(e.timeStamp,".json")}},me=ie.a.Panel,xe=h.a.Paragraph,ge=function(e){var t=e.gameHistory,n=e.onNext,a=e.onPrev;if(Object(c.useEffect)((function(){t&&function(e){var t=de.a.get(ne.HISTORIES)||{};de.a.set(ne.HISTORIES,Object(E.a)(Object(E.a)({},t),{},Object(Q.a)({},e.gameId,e)))}(t)})),!t)return Object(b.jsx)("div",{children:"Error: No game history specified"});var i=pe(t),s=Object(b.jsx)(se.a,{icon:Object(b.jsx)(oe.a,{}),status:"success",title:"Player "+t.winner+" wins!"});return t.result===r.DRAW?s=Object(b.jsx)(se.a,{icon:Object(b.jsx)(le.a,{}),status:"warning",title:"Draw!"}):t.result===r.TIMEOUT&&(s=Object(b.jsx)(se.a,{icon:Object(b.jsx)(ue.a,{}),status:"warning",title:"Timeout"})),Object(b.jsxs)(b.Fragment,{children:[s,Object(b.jsxs)(m.b,{children:[Object(b.jsx)(x.a,{onClick:a,type:"primary",children:"Play again"}),Object(b.jsx)(x.a,{onClick:n,children:"New game"}),Object(b.jsx)(l.b,{to:"/viewer?gameId=".concat(null===t||void 0===t?void 0:t.gameId),children:Object(b.jsx)(x.a,{icon:Object(b.jsx)(je.a,{}),children:"Show in viewer"})}),Object(b.jsx)(x.a,Object(E.a)(Object(E.a)({icon:Object(b.jsx)(be.a,{})},i),{},{children:"Download replay"}))]}),Object(b.jsx)(v.a,{}),Object(b.jsx)(ie.a,{children:Object(b.jsx)(me,{header:"Full Game History",children:Object(b.jsx)(xe,{children:Object(b.jsx)("pre",{children:JSON.stringify(t,null,2)})})},"1")})]})},ve=f.a.Step,ye=h.a.Title;!function(e){e[e.CONTROLLER_CREATOR=0]="CONTROLLER_CREATOR",e[e.GAME_SETUP=1]="GAME_SETUP",e[e.PLAYING=2]="PLAYING",e[e.SUMMARY=3]="SUMMARY"}(fe||(fe={}));var Se=function(){var e=Object(c.useState)(fe.CONTROLLER_CREATOR),t=Object(d.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)([]),i=Object(d.a)(a,2),s=i[0],o=i[1],l=Object(c.useState)(),u=Object(d.a)(l,2),j=u[0],O=u[1],h=Object(c.useState)(),p=Object(d.a)(h,2),m=p[0],x=p[1],g=Object(c.useCallback)((function(e){o(e)}),[o]),v=Object(c.useCallback)((function(e){O(e)}),[O]),y=Object(c.useCallback)((function(e){x(e)}),[x]),S=Object(c.useCallback)((function(){r((n+1)%(fe.SUMMARY+1))}),[n,r]),k=Object(c.useCallback)((function(){r((n-1)%(fe.SUMMARY+1))}),[n,r]);return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(ye,{children:"Play a Game"}),Object(b.jsxs)(f.a,{current:n,children:[Object(b.jsx)(ve,{title:"Controller Creator"}),Object(b.jsx)(ve,{title:"Game Setup"}),Object(b.jsx)(ve,{title:"Running"}),Object(b.jsx)(ve,{title:"Summary"})]}),Object(b.jsx)("br",{}),n===fe.CONTROLLER_CREATOR&&Object(b.jsx)(z,{onControllerChange:g,onNext:S}),n===fe.GAME_SETUP&&Object(b.jsx)(ce,{onConfigChange:v,onNext:S,onPrev:k}),n===fe.PLAYING&&Object(b.jsx)(re,{controllers:s,options:j,onPrev:k,onNext:S,gameComplete:y}),n===fe.SUMMARY&&Object(b.jsx)(ge,{gameHistory:m,onNext:S,onPrev:k})]})},ke=h.a.Title,Re=h.a.Paragraph,Te=function(e){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(ke,{children:"Snake Tron - Code Fights!"}),Object(b.jsx)(Re,{children:"What, you thought there would be content?"})]})},Ce=u.a.Content,Ee=function(e){return Object(b.jsx)(Ce,{className:"content",children:e.children})},Ie=u.a.Footer,Ne=function(){return Object(b.jsxs)(Ie,{className:"footer",children:["Created by ",Object(b.jsx)("a",{href:"http://samuel-lewis.com/",children:"Samuel Lewis"})]})},we=n(92),Ae=u.a.Header,Me=function(){return Object(b.jsxs)(Ae,{className:"header",children:[Object(b.jsx)("div",{className:"logo"}),Object(b.jsxs)(we.a,{theme:"dark",mode:"horizontal",children:[Object(b.jsx)(we.a.Item,{children:Object(b.jsx)(l.b,{to:"/",children:"Home"})},"home"),Object(b.jsx)(we.a.Item,{children:Object(b.jsx)(l.b,{to:"/game",children:"Game"})},"game"),Object(b.jsx)(we.a.Item,{children:Object(b.jsx)(l.b,{to:"/viewer",children:"Viewer"})},"viewer"),Object(b.jsx)(we.a.Item,{children:Object(b.jsx)(l.b,{to:"/tester",children:"Controller Tester"})},"tester"),Object(b.jsx)(we.a.Item,{children:Object(b.jsx)(l.b,{to:"/docs",children:"Docs"})},"docs")]})]})},Pe=n(326),Ue=n(321),De=n(322),_e=Pe.a.TabPane,Ge=h.a.Title,Le=h.a.Paragraph,ze="48e2ee9e-171e-45bd-8904-a762d8e2b782",He={playerNumber:1,playerCount:2,gameId:ze,gridSize:50},Fe={tick:2,positions:[[[42,31],[41,31],[40,31]],[[47,27],[47,28]]],lastMoves:[a.NORTH,a.SOUTH],food:[[35,16],[17,6]],playerAlive:[!0,!0],meta:{playerCount:2,gameId:ze,gridSize:50}},We=function(){var e=Object(c.useState)(null),t=Object(d.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(""),i=Object(d.a)(a,2),s=i[0],o=i[1],l=Object(c.useState)(""),u=Object(d.a)(l,2),j=u[0],O=u[1],f=Object(c.useCallback)((function(e){r(_.create(e))}),[r]),h=Object(c.useCallback)((function(){O(JSON.stringify(He,null,2)),null===n||void 0===n||n.init(He).then((function(e){return o(JSON.stringify(e,null,2))})).catch((function(e){return o(e.message)}))}),[n,o]),p=Object(c.useCallback)((function(){O(JSON.stringify(Fe,null,2)),null===n||void 0===n||n.update(Fe,1).then((function(e){return o(JSON.stringify(e,null,2))})).catch((function(e){return o(e.message)}))}),[n,o]),g=Object(c.useCallback)((function(){O(JSON.stringify(Fe,null,2)),null===n||void 0===n||n.end(Fe,1).then((function(e){return o(JSON.stringify(e,null,2))})).catch((function(e){return o(e.message)}))}),[n,o]);return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(Ge,{children:"Controller Tester"}),Object(b.jsx)(Pe.a,{defaultActiveKey:"1",children:Object(b.jsx)(_e,{tab:_.label,children:Object(b.jsx)(_.Selector,{onChange:f})},"1")}),Object(b.jsxs)(m.b,{children:[Object(b.jsx)(x.a,{onClick:h,children:"Test game initialise"}),Object(b.jsx)(x.a,{onClick:p,children:"Test game update"}),Object(b.jsx)(x.a,{onClick:g,children:"Test game end"})]}),Object(b.jsxs)(Ue.a,{gutter:16,children:[Object(b.jsxs)(De.a,{span:12,children:[Object(b.jsx)(v.a,{children:"Sent"}),Object(b.jsx)(Le,{children:j&&Object(b.jsx)("pre",{children:j})})]}),Object(b.jsxs)(De.a,{span:12,children:[Object(b.jsx)(v.a,{children:"Response"}),Object(b.jsx)(Le,{children:s&&Object(b.jsx)("pre",{children:s})})]})]})]})},Je=n(199),Ve=n(329),Ye=n(198),qe=n(337),Be=n(323),Ke=n(327),Xe=["#e6194B","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9A6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075"],Qe=function(e){return Xe[e%Xe.length]},Ze=400,$e=function(e,t){var n=Object(d.a)(e,2);return[n[0]*t+t/2,n[1]*t+t/2]};var et=function(e){var t=Object(c.useRef)(null),n=e.state,r=e.gridSize;return Object(c.useLayoutEffect)((function(){var e=t.current;if(e){var a=e.getContext("2d");if(a){var c=Ze/r;!function(e){e.clearRect(0,0,Ze,Ze),e.lineWidth=1,e.strokeStyle="white",e.strokeRect(0,0,Ze,Ze)}(a),n.positions.forEach((function(e,t){!function(e,t,n,r){var a=Qe(r),c=$e(n[0],t),i=Object(d.a)(c,2),s=i[0],o=i[1];e.lineWidth=t-2,e.strokeStyle=a,e.lineCap="square",e.beginPath(),e.moveTo(s,o),n.forEach((function(n){var r=$e(n,t),a=Object(d.a)(r,2),c=a[0],i=a[1];e.lineTo(c,i)})),e.stroke()}(a,c,e,t)})),n.food.forEach((function(e){return function(e,t,n){var r=$e(n,t),a=Object(d.a)(r,2),c=a[0],i=a[1];e.fillStyle="green",e.beginPath(),e.arc(c,i,t/2,0,2*Math.PI),e.fill()}(a,c,e)}))}}}),[t,n,r]),Object(b.jsx)("canvas",{width:Ze,height:Ze,ref:t})},tt=n(107),nt=n(109),rt=h.a.Paragraph,at=function(e){var t=e.frame;if(!t)return null;var n=new Array(t.playerAlive.length).fill(null).map((function(e,n){return{key:"Player ".concat(n),alive:t.playerAlive[n],lastMove:t.lastMoves[n],position:t.positions[n],playerNumber:n}})),r=[{title:"Player",dataIndex:"playerNumber",key:"playerNumber",render:function(e){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("span",{className:"dot",style:{backgroundColor:Qe(e)}}),"Player ",e]})}},{title:"Alive",dataIndex:"alive",key:"alive",render:function(e){return e?Object(b.jsx)(tt.a,{}):Object(b.jsx)(nt.a,{})}},{title:"Last Move",dataIndex:"lastMove",key:"lastMove"},{title:"Positions",dataIndex:"position",key:"position",render:function(e){return JSON.stringify(e)},ellipsis:!0}];return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)(rt,{children:["Tick: ",t.tick]}),Object(b.jsxs)(rt,{children:["Food: ",JSON.stringify(t.food)]}),Object(b.jsx)(Be.a,{size:"small",dataSource:n,columns:r,pagination:!1,expandable:{expandedRowRender:function(e){return Object(b.jsx)("p",{style:{margin:0},children:JSON.stringify(e.position)})}}})]})},ct=function(e){var t=e.history,n=Object(c.useState)(0),r=Object(d.a)(n,2),a=r[0],i=r[1],s=Object(c.useCallback)((function(e){return i(e)}),[i]);return t?Object(b.jsxs)(Ue.a,{justify:"center",children:[Object(b.jsxs)(De.a,{span:12,children:[Object(b.jsx)(et,{state:t.ticks[a],gridSize:t.gridSize}),Object(b.jsx)(Ke.a,{style:{width:"400px",marginLeft:0,marginRight:0},value:a,min:0,max:t.tickCount-1,onChange:s})]}),Object(b.jsx)(De.a,{span:12,children:Object(b.jsx)(at,{frame:t.ticks[a]})})]}):Object(b.jsx)("div",{children:"Error: No history loaded?!"})},it=["key","humanDate"],st=h.a.Title,ot=h.a.Paragraph,lt=function(e){var t=e.onDelete,n=Object(c.useCallback)((function(){Ve.a.warning({title:"Are you sure you want to delete all game replays?",closable:!0,okText:"Delete all",okCancel:!0,okButtonProps:{danger:!0,type:"primary"},content:Object(b.jsx)(ot,{children:"Are you sure you want to delete all game replays? This can not be undone."}),onOk:t})}),[t]);return Object(b.jsx)(x.a,{icon:Object(b.jsx)(k.a,{}),onClick:n,danger:!0,type:"text",children:"Delete all histories"})},ut=function(){var e=Object(j.f)(),t=Object(c.useState)(he().reverse()),n=Object(d.a)(t,2),a=n[0],i=n[1],s=Object(c.useState)(),o=Object(d.a)(s,2),u=o[0],O=o[1],f=new URLSearchParams(Object(j.g)().search),h=Object(c.useCallback)((function(){O(void 0),de.a.set(ne.HISTORIES,{}),i(he()),e.push("/viewer")}),[O,e]);Object(c.useEffect)((function(){var e=f.get("gameId");if(e)if("latest"!==e){var t=a.find((function(t){return t.gameId===e}));t?O(t):Ye.b.error("Could not find game ".concat(e))}else O(a[0])}),[a,O,f]);var p=Object(c.useMemo)((function(){return a.map((function(e){return Object(E.a)(Object(E.a)({},e),{},{key:e.gameId})}))}),[a]),m=[{title:"Timestamp",dataIndex:"timeStamp",key:"timeStamp",ellipsis:!0,sorter:{compare:function(e,t){return new Date(e.timeStamp).valueOf()-new Date(t.timeStamp).valueOf()},multiple:1},render:function(e){return Object(b.jsx)("span",{children:new Date(e).toString()})}},{title:"Result",dataIndex:"result",key:"result",sorter:{compare:function(e,t){return e.result.localeCompare(t.result)},multiple:2},render:function(e,t){var n=t.winner,a=e===r.WINNER?"green":e===r.DRAW?"blue":"red";return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(qe.a,{color:a,children:e}),-1!==n&&Object(b.jsxs)("span",{children:["Player ",n]})]})}},{title:"Player count",dataIndex:"playerCount",key:"playerCount",sorter:{compare:function(e,t){return e.playerCount-t.playerCount},multiple:4}},{title:"Tick count",dataIndex:"tickCount",key:"tickCount",sorter:{compare:function(e,t){return e.tickCount-t.tickCount},multiple:5}},{title:"Grid size",dataIndex:"gridSize",key:"gridSize",sorter:{compare:function(e,t){return e.gridSize-t.gridSize},multiple:6}},{title:"ID",dataIndex:"gameId",key:"gameId",ellipsis:!0,sorter:{compare:function(e,t){return e.gameId.localeCompare(t.gameId)},multiple:7}},{title:"Actions",key:"actions",render:function(t,n){n.key,n.humanDate;var r=Object(Je.a)(n,it),a=pe(r);return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(y.a,{title:"View",children:Object(b.jsx)(l.b,{to:"/viewer?gameId=".concat(r.gameId),children:Object(b.jsx)(x.a,{icon:Object(b.jsx)(je.a,{})})})}),Object(b.jsx)(y.a,{title:"Download",children:Object(b.jsx)(x.a,Object(E.a)({icon:Object(b.jsx)(be.a,{})},a))}),Object(b.jsx)(y.a,{title:"Delete",children:Object(b.jsx)(x.a,{onClick:function(){!function(e){var t=de.a.get(ne.HISTORIES)||{};t[e]=void 0,de.a.set(ne.HISTORIES,t),he()}(n.gameId),i(he()),u&&u.gameId===n.gameId&&(O(void 0),e.push("/viewer"))},icon:Object(b.jsx)(k.a,{})})})]})}}];return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(st,{children:"Game Viewer"}),u&&Object(b.jsx)(ct,{history:u}),Object(b.jsx)(v.a,{children:"Saved Rounds"}),Object(b.jsx)(Be.a,{dataSource:p,columns:m,pagination:{pageSize:10,position:["topRight","bottomRight"],showTotal:function(e){return"".concat(e," games")}}}),Object(b.jsx)(lt,{onDelete:h})]})};var jt=function(){return Object(b.jsx)("div",{className:"App",children:Object(b.jsxs)(u.a,{className:"layout",children:[Object(b.jsx)(Me,{}),Object(b.jsx)(Ee,{children:Object(b.jsxs)(j.c,{children:[Object(b.jsx)(j.a,{exact:!0,path:"/",component:Te}),Object(b.jsx)(j.a,{path:"/game",component:Se}),Object(b.jsx)(j.a,{path:"/viewer",component:ut}),Object(b.jsx)(j.a,{path:"/tester",component:We}),Object(b.jsx)(j.a,{path:"/docs",component:O})]})}),Object(b.jsx)(Ne,{})]})})};o.a.render(Object(b.jsx)(i.a.StrictMode,{children:Object(b.jsx)(l.a,{children:Object(b.jsx)(jt,{})})}),document.getElementById("root"))}},[[316,1,2]]]);
//# sourceMappingURL=main.d1ec3d00.chunk.js.map